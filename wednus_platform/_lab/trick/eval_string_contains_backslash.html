<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Test - wednus.js</title>
<script type='text/javascript' src='../../wednus.js'></script>
<script type='text/javascript'>
W.module('debug');	// W.test, W.Timer
</script>

<script type='text/javascript'>
W.event(window, 'onload', parse);


function parse(){

var tmp = W.$('code').value;

/*
tmp = '({a:"abc",css:function(){document.write("\a");}})';
tmp = '({a:"abc",css:"http:/\/scd.mm-b1.yimg.com\/image\/481989943"})';
tmp = '({a:"abc",css:function(url){document.write("<a href=\'"+url+"\'>link<\/a>");}})';
*/
//alert(tmp);

/*
var slash = tmp.lastIndexOf("\\");
var len = (tmp.length - slash)-1;
tmp = tmp.substring(slash+1); 
alert(tmp);
*/

//var W2 = eval(tmp);
var W2 = eval(tmp);

alert(typeof W2.css);
}

//W2.css();

/*

    'toString:function(isDebug){if(!isDebug){isDebug=false;}var lineBreak="";var tab="";if(isDebug){lineBreak="\n";tab=" ";}return serialize(this);function serialize(obj){var str="{"+lineBreak;var first=true;for(var i in obj){if(first){first=false;}else{str+=","+lineBreak;}str+=tab+i+":";switch(typeof obj[i]){case "string":str+="\""+obj[i]+"\"";break;case "function":if(i=="js"){str+="function(url){document.write(\"<script type=\"text/javascript\" src=\"\"+url+\"\"><\\/script>\");}";break;}var s="";s+=obj[i];s=s.replace(/\s+/g," ");s=s.replace(/^\s(.*)/,"$1");s=s.replace(/(.*)\s$/,"$1");s=s.replace(/\s([\x21\x25\x26\x28\x29\x2a\x2b\x2c\x2d\x2f\x3a\x3b\x3c\x3d\x3e\x3f\x5b\x5d\x5c\x7b\x7c\x7d\x7e])/g,"$1");str+=s.replace(/([\x21\x25\x26\x28\x29\x2a\x2b\x2c\x2d\x2f\x3a\x3b\x3c\x3d\x3e\x3f\x5b\x5d\x5c\x7b\x7c\x7d\x7e])\s/g,"$1");break;case "object":str+=W.serialize(obj[i]);break;default:str+=obj[i];}}return str+lineBreak+"}";}},'+
    'init:function(){if(document.getElementsByTagName){if(this.path!=""){return;}var scripts=document.getElementsByTagName("script");for(var i=0;i<scripts.length;++i){if(scripts[i].src.match(/\bwednus\.js$/i)||scripts[i].src.match(/\bwednus_compact\.js$/i)){W.path=scripts[i].src.substring(0,scripts[i].src.lastIndexOf("/")+1);break;}}}else{if(this.path==""){alert("This browser does not support the basic DOM level1.\nTo support this browser,the author of this page needs to set\"W.path\" to the installation path(URL)of Wednus Platform manually. Meanwhile,the platform will be unloaded.\nThank you.\n\nWednus team.");var undefined;W=undefined;return false;}}for(var i in window){W.names+=i+",";}this.clear();this.root=document.body;this.body=document.createElement("div");this.body.style.display="inline";this.root.appendChild(this.body);this.scroll(false);this.refresh();return true;},'+


    'js:function(url){document.write("<script type="text/javascript" src=\""+ url +"\"><\/script>");},'+
    'clear:function(){document.write("<div id=\"_wednus_platform_\" style=\"display:none;position:absolute;\">.</div>");document.close();},'+
    'css:function(url){document.write("<link href=\""+url+"\" rel=\"stylesheet\" type=\"text/css\">");},'+


var timer = new W.Timer();
timer.start();

var W2 = eval(tmp);
W2.init();
W.test(true, 'reconstruction doesn\'t take much time');

timer.finish();
*/

/*

W.halt();
W = null;




W = eval('('+ tmp +')');
timer = new W.Timer();
timer.start();

W.test(typeof tmp == 'string', 'forward W as string');
W.init()

timer.finish();



*/
</script>
</head>
<body>
<textarea id='code' style='width:100%;height:400px;'>
({
    path:"file:///C:/Documents%20and%20Settings/sundew/workspace/wednus_platform/",
    version:"0.1.0_pre8",
    width:1012,
    height:519,
    modules:{"module":["dkernel","wes","wml","wss","wrs"],"control":[],"include":[],"snippet":[],"app":[]},
    check_namespace:function(){},
    $:function(id){return document.getElementById(id);},
    load:function(subpath,name,lib){lib=lib?lib:"include";name=name.split(",");if(name.length!=1){for(var i=0;i<name.length;++i){this.load(subpath,name[i],lib);}return;}if(getIndex(lib,name)!=-1){return;}else{this.modules[lib][this.modules[lib].length]=name+"";}this.js(this.path+subpath+"/"+name+".js");function getIndex(lib,name){for(var i=0;i<W.modules[lib].length;++i){if(W.modules[lib][i]==name){return i;}}return-1;}},
    refresh:function(){var db=this.root;if(window.innerWidth!=null){this.width=window.innerWidth;this.height=window.innerHeight;}else{if(window.opera!=null){this.width=db.clientWidth;this.height=db.clientHeight;}else{if(document.documentElement!=null){this.width=document.documentElement.clientWidth;this.height=document.documentElement.clientHeight;}}}this.width=parseInt(this.width);this.height=parseInt(this.height);this.body.style.width=this.width+"px";this.body.style.height=this.height+"px";},
    scroll:function(isAuto){if(isAuto){document.write("<style>html{overflow-x:auto;overflow-y:auto;}</style>");}else{document.write("<style>html{overflow-x:hidden;overflow-y:hidden;overflow:hidden;}</style>");}document.close();},
    background:function(bg){bg=bg?bg:"";this.root.style.background=bg;},
    names:"undefinedwindow,W,document,Packages,sun,java,netscape,XPCNativeWrapper,GeckoActiveXObject,Components,parent,top,scrollbars,name,scrollX,scrollY,scrollTo,scrollBy,getSelection,scrollByLines,scrollByPages,sizeToContent,dump,setTimeout,setInterval,clearTimeout,clearInterval,setResizable,captureEvents,releaseEvents,routeEvent,enableExternalCapture,disableExternalCapture,prompt,open,openDialog,frames,find,self,screen,history,content,menubar,toolbar,locationbar,personalbar,statusbar,directories,closed,crypto,pkcs11,controllers,opener,status,defaultStatus,innerWidth,innerHeight,outerWidth,outerHeight,screenX,screenY,pageXOffset,pageYOffset,scrollMaxX,scrollMaxY,length,fullScreen,alert,confirm,focus,blur,back,forward,home,stop,print,moveTo,moveBy,resizeTo,resizeBy,scroll,close,updateCommands,atob,btoa,frameElement,removeEventListener,dispatchEvent,getComputedStyle,",
    root:{},
    body:{},
    removeComments:function(s){var lines,i,t;lines=s.split("\n");t="";for(i=0;i<lines.length;i++){t+=lines[i].replace(/([^\x2f]*)\x2f\x2f.*$/,"$1");}t=t.replace(/(.*)\n(.*)/g,"$1 $2");lines=t.split("*/");t="";for(i=0;i<lines.length;i++){t+=lines[i].replace(/(.*)\x2f\x2a(.*)$/g,"$1 ");}return t;},
    json:{"copyright":"(c)2005 JSON.org","license":"http://www.JSON.org/license.html"},
    serialize:function(v){var f=s[typeof v];if(f){v=f(v);if(typeof v=="string"){return v;}}return null;},
    events:{},
    event:function(source,event,func,arg1){var task;if(!W.events[source]){W.events[source]={};}if(!W.events[source][event]){W.events[source][event]=[];source[event]=(function(){for(var i=0;i<W.events[source][event].length;++i){task=W.events[source][event][i];task[0](task[1]);}});}W.events[source][event][W.events[source][event].length]=[func,arg1];},
    c:{},
    a:{},
    u:{},

    css:function(url){document.write("<link href='"+url+"' rel='stylesheet' type='text/css'>");},
    js:function(url){document.write("<script type='text/javascript' src='"+ url +"'></script>");},
    init:function(){if(document.getElementsByTagName){if(this.path!=""){return;}var scripts=document.getElementsByTagName("script");for(var i=0;i<scripts.length;++i){if(scripts[i].src.match(/\bwednus\.js$/i)||scripts[i].src.match(/\bwednus_compact\.js$/i)){W.path=scripts[i].src.substring(0,scripts[i].src.lastIndexOf("/")+1);break;}}}else{if(this.path==""){alert("This browser does not support the basic DOM level1.\nTo support this browser,the author of this page needs to set\"W.path\" to the installation path(URL)of Wednus Platform manually. Meanwhile,the platform will be unloaded.\nThank you.\n\nWednus team.");var undefined;W=undefined;return false;}}for(var i in window){W.names+=i+",";}this.clear();this.root=document.body;this.body=document.createElement("div");this.body.style.display="inline";this.root.appendChild(this.body);this.scroll(false);this.refresh();return true;},
    toString:function(isDebug){if(!isDebug){isDebug=false;}var lineBreak="";var tab="";if(isDebug){lineBreak="\n";tab=" ";}return serialize(this);function serialize(obj){var str="{"+lineBreak;var first=true;for(var i in obj){if(first){first=false;}else{str+=","+lineBreak;}str+=tab+i+":";switch(typeof obj[i]){case "string":str+="\""+obj[i]+"\"";break;case "function":if(i=="js"){str+="function(url){document.write(\"<script type='text/javascript' src='\"+url+\"'></script>\");}";break;}var s="";s+=obj[i];s=s.replace(/\s+/g," ");s=s.replace(/^\s(.*)/,"$1");s=s.replace(/(.*)\s$/,"$1");s=s.replace(/\s([\x21\x25\x26\x28\x29\x2a\x2b\x2c\x2d\x2f\x3a\x3b\x3c\x3d\x3e\x3f\x5b\x5d\x5c\x7b\x7c\x7d\x7e])/g,"$1");str+=s.replace(/([\x21\x25\x26\x28\x29\x2a\x2b\x2c\x2d\x2f\x3a\x3b\x3c\x3d\x3e\x3f\x5b\x5d\x5c\x7b\x7c\x7d\x7e])\s/g,"$1");break;case "object":str+=W.serialize(obj[i]);break;default:str+=obj[i];}}return str+lineBreak+"}";}},
    clear:function(){document.write("<div id='_wednus_platform_' style='display:none;position:absolute;'>.</div>");document.close();},
        
    include:function(subpath,name){this.load(subpath,name,"include");},
    include_css:function(subpath,name){this.css(this.path+subpath+"/"+name+".css");},
    control:function(name){this.load("control/"+name,name,"control");},
    module:function(name){this.load("module/"+name,name,"module");},
    snippet:function(name){this.load("snippet/"+name,name,"snippet");},
    app:function(name,args){this.load("app/"+name,name,"app");this.event(window,"onload",(function(){W.a[name](args);}));},
    style:function(obj,wss){if(typeof obj=="string"){obj=document.createElement(obj);}var s=obj.style;var tmp,latestProp;if(!wss){return obj;}wss=wss.split(";");for(var i=0;i<wss.length;++i){tmp=wss[i].split(":");if(typeof tmp[1]=="undefined"){s[tmp[0]]=latestProp;}else{s[tmp[0]]=latestProp=tmp[1];}}return obj;},
    loader:{},
    request:function(url,callback){var jump=this.loader;jump.src=url;jump.onload=(function(){var data=jump.contentDocument?jump.contentDocument.body.innerHTML:jump.contentWindow.document.body.innerHTML;data=data.replace(/(<([^>]+)>)/gi,"");if(callback!=null){callback(data);}});},
    proxy_url:"http://audreybear.ph.utexas.edu/~sundew/wrs.php",
    proxy:function(url,callback){if(callback==null){callback="";}W.js(W.proxy_url+"?callback="+callback+"&url="+escape(url));},
    opener:{"isStarted":false},
    open:function(url){if(!this.opener.isStarted){W.style(W.opener,"width:100%;height:"+W.height+"px;display:block");W.event(window,"onresize",(function(){W.refresh();W.opener.style.height=W.height+"px";}));this.opener.isStarted=true;}var isLoaded=false;W.opener.src=W.path+"module/dkernel/lib/loading.html";W.opener.onload=(function(){load();});W.opener.onreadystatechange=(function(){if(this.readyState=="complete"){load();}});function load(){if(!isLoaded){W.opener.src=url;isLoaded=true;}}},
    close:function(){W.opener.style.display="none";W.opener.isStarted=false;},
    wrap:function(obj){var wrapper=document.createElement("div");wrapper.id="_wednus_wrapper_";W.style(wrapper,"position:absolute;width:100%;height:100%;display:block;overflow:auto;");wrapper.appendChild(obj);document.body.appendChild(wrapper);},
    write:function(str){W.style(W.body,"width:100%;height:100%;position:absolute;overflow:auto;");W.body.innerHTML=str;}
})
</textarea>
</body>
</html>